jQuery.extendIf = function (d, e) { if (d && e) { for (var b in e) { if (typeof d[b] == "undefined") { d[b] = e[b] } } } return d }; if (typeof (Ext) == "undefined") { jQuery.extend(Function.prototype, { createCallback: function () { var b = arguments; var c = this; return function () { return c.apply(window, b) } }, createDelegate: function (d, c, b) { var e = this; return function () { var g = c || arguments; if (b === true) { g = Array.prototype.slice.call(arguments, 0); g = g.concat(c) } else { if (typeof b == "number") { g = Array.prototype.slice.call(arguments, 0); var f = [b, 0].concat(c); Array.prototype.splice.apply(g, f) } } return e.apply(d || window, g) } }, defer: function (d, f, c, b) { var e = this.createDelegate(f, c, b); if (d) { return setTimeout(e, d) } e(); return 0 }, createSequence: function (c, b) { if (typeof c != "function") { return this } var d = this; return function () { var e = d.apply(this || window, arguments); c.apply(b || this || window, arguments); return e } }, createInterceptor: function (c, b) { if (typeof c != "function") { return this } var d = this; return function () { c.target = this; c.method = d; if (c.apply(b || this || window, arguments) === false) { return } return d.apply(this || window, arguments) } } }); jQuery.extendIf(String, { escape: function (b) { return b.replace(/('|\\)/g, "\\$1") }, leftPad: function (e, c, d) { var b = new String(e); if (!d) { d = " " } while (b.length < c) { b = d + b } return b.toString() }, format: function (c) { var b = Array.prototype.slice.call(arguments, 1); return c.replace(/\{(\d+)\}/g, function (d, e) { return b[e] }) } }) } String.prototype.isInteger = function () { return !isNaN(parseInt(this)) }; String.prototype.isFloat = function () { return !isNaN(parseFloat(this)) }; String.prototype.toggle = function (c, b) { return this == c ? b : c }; String.prototype.trim = function () { var b = /^\s+|\s+$/g; return function () { return this.replace(b, "") } }(); String.prototype.translate = function (e, d) { if (!(e.length && d.length) || e.length != d.length) { return this } var c = this; for (var b = 0; b < e.length; b++) { if (typeof (e) == "string") { c = c.replace(new RegExp(e.charAt(b), "g"), d.charAt(b)) } else { c = c.replace(new RegExp(e[b], "g"), d[b]) } } return c }; String.prototype.isDigit = function () { return /^\d+$/.test(this) }; String.prototype.removeWords = function (f) { var e = this.split(" "); var d = new Array(); for (var c = 0; c < e.length; c++) { d.push(e[c]); for (var b = 0; b < f.length; b++) { if (d[c] == f[b]) { d.pop(); break } } } return d.join(" ") }; jQuery.extendIf(Number.prototype, { constrain: function (c, b) { return Math.min(Math.max(this, c), b) }, isInteger: function () { return !isNaN(parseInt(this)) }, isFloat: function () { return !isNaN(parseFloat(this)) } }); jQuery.extendIf(Array.prototype, { indexOf: function (d) { for (var c = 0, b = this.length; c < b; c++) { if (this[c] == d) { return c } } return -1 }, removeObject: function (c) { var b = this.indexOf(c); if (b != -1) { this.splice(b, 1) } return this }, binarySearch: function binarySearch(g, c) { var b = 0, f = this.length - 1, d, e; while (b <= f) { d = parseInt((b + f) / 2, 10); e = c(this[d], g); if (e < 0) { b = d + 1; continue } if (e > 0) { f = d - 1; continue } return d } return -1 }, inject: function (d, c) { for (var b = 0; b < this.length; b++) { d = c(d, this[b], b) } return d }, map: function (e, d) { var b = new Array(this.length); for (var c = 0, f = this.length; c < f; c++) { if (c in this) { b[c] = e.call(d, this[c], c, this) } } return b }, intersect: function () { if (!arguments.length) { return [] } var e = this; var d = a2 = null; var h = 0; while (h < arguments.length) { d = []; a2 = arguments[h]; var c = e.length; var b = a2.length; for (var g = 0; g < c; g++) { for (var f = 0; f < b; f++) { if (e[g] === a2[f]) { d.push(e[g]) } } } e = d; h++ } return d.unique() }, unique: function () { var c = []; var b = this.length; for (var e = 0; e < b; e++) { for (var d = e + 1; d < b; d++) { if (this[e] === this[d]) { d = ++e } } c.push(this[e]) } return c } }); Date.prototype.getElapsed = function (b) { return Math.abs((b || new Date()).getTime() - this.getTime()) }; if (typeof (usig) == "undefined") { usig = {} } usig.debug = function (b) { if (window.console && window.console.log) { window.console.log(b) } }; if (typeof (usig) == "undefined") { usig = {} } if (typeof (usig.Calle) == "undefined") { usig.Calle = function (b, c, e, d) { this.codigo = b; this.nombre = c; this.alturaValida = function (g) { if (e instanceof Array) { if (e.length == 0) { throw (new usig.ErrorCalleSinAlturas(this.nombre)); return false } var f = false; for (a in e) { f = f || ((parseInt(e[a][0]) <= parseInt(g)) && (parseInt(e[a][1]) >= parseInt(g))) } return f } }; this.getTramos = function () { return e }; this.toString = function () { return this.nombre }; this.seCruzaCon = function (f) { if (d) { return d.indexOf(f.codigo) >= 0 } }; this.toJson = function () { return { codigo: this.codigo, nombre: this.nombre } }; this.isEqual = function (f) { return this.codigo == f.codigo } }; usig.Calle.fromObj = function (b) { return new usig.Calle(b.codigo, b.nombre) } } if (typeof (usig) == "undefined") { usig = {} } if (typeof (usig.Direccion) == "undefined") { usig.Direccion = (function (b) { return function (c, g) { var f = null; var k = null; var j = 0; var e = null; var h = ""; var d = null; if (c instanceof usig.Calle) { f = c } else { return null } if (g instanceof usig.Calle) { k = g; e = usig.Direccion.CALLE_Y_CALLE } else { if (!isNaN(parseInt(g))) { e = usig.Direccion.CALLE_ALTURA; j = parseInt(g) } else { return null } } this.getCalle = function () { return f }; this.getCalleCruce = function () { if (e == usig.Direccion.CALLE_Y_CALLE) { return k } else { return null } }; this.getAltura = function () { return j }; this.getTipo = function () { return e }; this.toString = function () { if (e == usig.Direccion.CALLE_ALTURA) { res = f.toString() + " " + (j > 0 ? j : "S/N") } else { var l = k.nombre; var m = l.match(/^(I|Hi|HI).*/) ? " e " : " y "; res = f.nombre + m + k.nombre } if (f.partido != undefined) { res = res + ", " + f.localidad } return res }; this.setCoordenadas = function (l) { d = usig.Punto.fromPunto(l) }; this.setSmp = function (l) { h = l }; this.getCoordenadas = function () { return d }; this.getSmp = function () { return h }; this.clone = function () { var l = new usig.Direccion(f, g); return b.extend(true, l, this) }; this.toJson = function () { return { tipo: e, calle: f.toJson(), altura: j, calle_cruce: k ? k.toJson() : null, smp: h, coordenadas: d } }; this.isEqual = function (l) { var m = (l instanceof usig.Direccion && (e == l.getTipo()) && ((e == usig.Direccion.CALLE_ALTURA && f.isEqual(l.getCalle()) && j == l.getAltura()) || (e == usig.Direccion.CALLE_Y_CALLE && ((f.isEqual(l.getCalle()) && k.isEqual(l.getCalleCruce())) || (f.isEqual(l.getCalleCruce()) && k.isEqual(l.getCalle())))))); return m } } })(jQuery); usig.Direccion.CALLE_ALTURA = 0; usig.Direccion.CALLE_Y_CALLE = 1; usig.Direccion.fromObj = function (d) { var b = null; if (d.tipo != undefined) { b = new usig.Direccion(usig.Calle.fromObj(d.calle), (d.tipo == usig.Direccion.CALLE_ALTURA) ? d.altura : usig.Calle.fromObj(d.calle_cruce)) } else { var c = new usig.Calle(d.cod_calle, d.calle); if (d.cod_calle2 != null) { b = new usig.Direccion(c, new usig.Calle(d.cod_calle2, d.calle2)) } else { b = new usig.Direccion(c, d.altura) } } if (d.smp != undefined && d.smp != null) { b.setSmp(d.smp) } if (d.coordenadas != undefined && d.coordenadas != null) { if (typeof (d.coordenadas) == "string") { b.setCoordenadas(usig.Punto.fromWkt(d.coordenadas)) } else { b.setCoordenadas(usig.Punto.fromObj(d.coordenadas)) } } return b } } if (!this.JSON) { this.JSON = {} } (function () { function f(n) { return n < 10 ? "0" + n : n } if (typeof Date.prototype.toJSON !== "function") { Date.prototype.toJSON = function (key) { return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null }; String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function (key) { return this.valueOf() } } var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, gap, indent, meta = { "\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" }, rep; function quote(string) { escapable.lastIndex = 0; return escapable.test(string) ? '"' + string.replace(escapable, function (a) { var c = meta[a]; return typeof c === "string" ? c : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) }) + '"' : '"' + string + '"' } function str(key, holder) { var i, k, v, length, mind = gap, partial, value = holder[key]; if (value && typeof value === "object" && typeof value.toJSON === "function") { value = value.toJSON(key) } if (typeof rep === "function") { value = rep.call(holder, key, value) } switch (typeof value) { case "string": return quote(value); case "number": return isFinite(value) ? String(value) : "null"; case "boolean": case "null": return String(value); case "object": if (!value) { return "null" } gap += indent; partial = []; if (Object.prototype.toString.apply(value) === "[object Array]") { length = value.length; for (i = 0; i < length; i += 1) { partial[i] = str(i, value) || "null" } v = partial.length === 0 ? "[]" : gap ? "[\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "]" : "[" + partial.join(",") + "]"; gap = mind; return v } if (rep && typeof rep === "object") { length = rep.length; for (i = 0; i < length; i += 1) { k = rep[i]; if (typeof k === "string") { v = str(k, value); if (v) { partial.push(quote(k) + (gap ? ": " : ":") + v) } } } } else { for (k in value) { if (Object.hasOwnProperty.call(value, k)) { v = str(k, value); if (v) { partial.push(quote(k) + (gap ? ": " : ":") + v) } } } } v = partial.length === 0 ? "{}" : gap ? "{\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "}" : "{" + partial.join(",") + "}"; gap = mind; return v } } if (typeof JSON.stringify !== "function") { JSON.stringify = function (value, replacer, space) { var i; gap = ""; indent = ""; if (typeof space === "number") { for (i = 0; i < space; i += 1) { indent += " " } } else { if (typeof space === "string") { indent = space } } rep = replacer; if (replacer && typeof replacer !== "function" && (typeof replacer !== "object" || typeof replacer.length !== "number")) { throw new Error("JSON.stringify") } return str("", { "": value }) } } if (typeof JSON.parse !== "function") { JSON.parse = function (text, reviver) { var j; function walk(holder, key) { var k, v, value = holder[key]; if (value && typeof value === "object") { for (k in value) { if (Object.hasOwnProperty.call(value, k)) { v = walk(value, k); if (v !== undefined) { value[k] = v } else { delete value[k] } } } } return reviver.call(holder, key, value) } cx.lastIndex = 0; if (cx.test(text)) { text = text.replace(cx, function (a) { return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) }) } if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) { j = eval("(" + text + ")"); return typeof reviver === "function" ? walk({ "": j }, "") : j } throw new SyntaxError("JSON.parse") } } }()); if (typeof (usig) == "undefined") { usig = {} } if (typeof (usig.data) == "undefined") { usig.data = {} } if (typeof (usig.defaults) == "undefined") { usig.defaults = {} } usig.defaults.Callejero = { server: "//servicios.usig.buenosaires.gob.ar/callejero", lazyDataLoad: false, loadFullDatabase: true, callesEnMinusculas: false, encoding: "utf-8", expirationTime: 10080 }; usig.Callejero = (function (h) { var b = {}, p = this, e = false, m = { ready: [] }, n = false; function f(u, x) { var t = true; for (var s = 0; s < u.length; s++) { var v = u[s]; v.lastIndex = 0; if (!v.test(x[2])) { t = false; break } } return t } function q(s) { n = false; if (s.length != usig.data.Callejero.length) { alert("Se produjo un error al cargar la información de cruces de calles."); return } for (var r = 0; r < usig.data.Callejero.length; r++) { usig.data.Callejero[r].push(s[r]) } } function o(r) { usig.data.Callejero = r; n = false; d("ready") } function j() { n = true; h.ajax({ type: "GET", url: b.server, data: { full: 1, cruces: 1, encoding: b.encoding }, dataType: "jsonp", success: q, error: function () { alert("Se produjo un error al intentar cargar la información de calles.") } }) } function c(r) { n = true; h.ajax({ type: "GET", url: b.server, data: b.loadFullDatabase ? { full: 1, encoding: b.encoding, minusculas: b.callesEnMinusculas ? 1 : 0 } : { encoding: b.encoding, minusculas: b.callesEnMinusculas ? 1 : 0 }, dataType: "jsonp", success: r, error: function () { alert("Se produjo un error al intentar cargar la información de calles.") } }) } function g() { if (!n) { if (!l()) { c(o) } else { var s; try { if (localStorage.callejero) { s = JSON.parse(localStorage.callejero) } if (s && (new Date().getTime() < s.expiration)) { o(JSON.parse(s.calles)) } else { c(function (v) { var t = b.expirationTime * 60 * 1000; var u = { calles: JSON.stringify(v), expiration: new Date().getTime() + t }; try { localStorage.callejero = JSON.stringify(u) } catch (w) { console.log("No se pudo grabar el callejero en LocalStorage.") } o(v) }) } } catch (r) { c(o) } } } } function l() { try { return "localStorage" in window && window.localStorage !== null } catch (r) { return false } } function d(s) { for (var r = 0; r < m[s].length; r++) { m[s][r]() } } function k(t, s) { var u = false; for (var r = 0; r < m[t].length; r++) { u = u || (m[t][r] == s) } if (!u) { m[t].push(s) } } return { init: function (r) { b = h.extend({}, usig.defaults.Callejero, r); if (typeof (b.onReady) == "function") { k("ready", b.onReady) } e = true; if (!usig.data.Callejero && !b.lazyDataLoad) { g.defer(100) } else { if (usig.data.Callejero) { d("ready"); m.ready = [] } } return this }, buscarPorCodigo: function (u) { var r = []; if (/^[0-9]+$/.test(u)) { var t = usig.data.Callejero.binarySearch(u, function (w, v) { return w[0] - v }); if (t > -1) { var s = usig.data.Callejero[t]; r.push(new usig.Calle(s[0], s[1], s[3], s[4])); i = t + 1; while (i < usig.data.Callejero.length && usig.data.Callejero[i][0] == u) { s = usig.data.Callejero[i]; r.push(new usig.Calle(s[0], s[1], s[3], s[4])); i++ } i = t - 1; while (i >= 0 && usig.data.Callejero[i][0] == u) { s = usig.data.Callejero[i]; r.unshift(new usig.Calle(s[0], s[1], s[3], s[4])); i-- } } } return r }, matcheaCalle: function (w, r) { var u = []; var t = []; var s = w.replace(/"/g, "").translate("áéíóúüÁÉÍÓÚÜàèìòùÀÈÌÒÙ", "aeiouuAEIOUUaeiouAEIOU").toUpperCase().trim(); var v = s.split(" "); wordsRE = v.map(function (z) { return new RegExp("^" + z + "| " + z, "gi") }); var y = new RegExp("SNO|SIN NOMBRE OFICIAL|NO OFICIAL|PASAJE|PJE", "i"); if (this.listo()) { for (var x = 0; x < usig.data.Callejero.length; x++) { if (f(wordsRE, usig.data.Callejero[x])) { if (!y.test(usig.data.Callejero[x][1]) && usig.data.Callejero[x][3].length != 0) { u.push(new usig.Calle(usig.data.Callejero[x][0], usig.data.Callejero[x][1], usig.data.Callejero[x][3], usig.data.Callejero[x][4])) } else { t.push(new usig.Calle(usig.data.Callejero[x][0], usig.data.Callejero[x][1], usig.data.Callejero[x][3], usig.data.Callejero[x][4])) } if (!isNaN(parseInt(r)) && u.length >= parseInt(r)) { break } } } u = u.concat(t); if (!isNaN(parseInt(r)) && u.length >= parseInt(r)) { u = u.splice(0, r) } if (usig.data.Callejero[0].length < 5 && !n) { j() } } else { g(); throw (new usig.ErrorEnCargaDelCallejero()) } return u }, tieneTramosComoAv: function (s) { var r = usig.data.Callejero.binarySearch(s.codigo, function (u, t) { return u[0] - t }); return s.codigo != 0 && (usig.data.Callejero[r - 1][0] == s.codigo || usig.data.Callejero[r + 1][0] == s.codigo) }, getNombreCalle: function (t, u) { var r = this.buscarPorCodigo(t); for (var s = 0; s < r.length; s++) { if (r[s].alturaValida(u)) { return r[s].nombre } } return "" }, listo: function () { return usig.data.Callejero && usig.data.Callejero instanceof Array }, inicializado: function () { return e } } })(jQuery); if (typeof (usig) == "undefined") { usig = {} } usig.StringDireccion = (function (b) { return function (e, d) { this.tipo = usig.StringDireccion.INVALIDO; this.strCalles = ""; this.strAltura = ""; this.strInput = e.replace(/"/g, "").replace(/[\.,\(\)']/g, " ").toUpperCase().trim(); var j = /[sS][/\\][nN]/; function f(l, k) { return l.isDigit() || (k && j.test(l)) } this.setearCalleAltura = function () { c = this.strInput.split(" "); this.maxWordLen = c.inject(0, function (n, l, m) { return Math.max(l.trim().length, n) }); var k = c.length; if (k > 1 && f(c[k - 1], d)) { this.tipo = usig.StringDireccion.CALLE_ALTURA; this.strCalles = c.inject("", function (n, l, m) { return m < (k - 1) ? (n != "" ? n + " " + l : l) : n }); this.strAltura = c[k - 1] } else { this.tipo = usig.StringDireccion.CALLE; this.strCalles = this.strInput } }; if (this.strInput.length > 0) { var c = this.strInput.split(" Y "); if (c.length >= 2) { var h = g(this.strInput); c = h.split(" Y "); if (c.length >= 2) { this.tipo = usig.StringDireccion.CALLE_Y_CALLE; this.strCalles = [c[0].replace(" & ", " Y "), c[1].replace(" & ", " Y ")] } } c = this.strInput.split(" E "); if (c.length >= 2) { if (parseInt(c[c.length - 1]) != c[c.length - 1]) { this.tipo = usig.StringDireccion.CALLE_Y_CALLE; this.strCalles = c } } if (this.tipo == usig.StringDireccion.INVALIDO) { this.setearCalleAltura() } } else { this.tipo = usig.StringDireccion.INVALIDO } function g(k) { return k.translate(["GELLY Y OBES", "MENENDEZ Y PELAYO", "OLAGUER Y FELIU", "ORTEGA Y GASSET", "PAULA Y RODRIGUEZ", "PAZ Y FIGUEROA", "PI Y MARGALL", "RAMON Y CAJAL", "TORRES Y TENORIO", "TREINTA Y TRES"], ["GELLY & OBES", "MENENDEZ & PELAYO", "OLAGUER & FELIU", "ORTEGA & GASSET", "PAULA & RODRIGUEZ", "PAZ & FIGUEROA", "PI & MARGALL", "RAMON & CAJAL", "TORRES & TENORIO", "TREINTA & TRES"]) } this.quitarAvsCalle = function () { var k = ["AV", "AVDA", "AVENIDA"]; if (this.tipo == usig.StringDireccion.CALLE_ALTURA) { this.strCalles = this.strCalles.removeWords(k) } else { if (this.tipo == usig.StringDireccion.CALLE_Y_CALLE) { this.strCalles[0] = this.strCalles[0].removeWords(k) } } }; this.quitarAvsCalleCruce = function () { var k = ["AV", "AVDA", "AVENIDA"]; if (this.tipo == usig.StringDireccion.CALLE_Y_CALLE) { this.strCalles[1] = this.strCalles[1].removeWords(k) } }; this.quitarPasajes = function () { var k = ["PJE", "PSJE", "PASAJE"]; if (this.tipo == usig.StringDireccion.CALLE_ALTURA) { this.strCalles = this.strCalles.removeWords(k) } else { if (this.tipo == usig.StringDireccion.CALLE_Y_CALLE) { this.strCalles[0] = this.strCalles[0].removeWords(k); this.strCalles[1] = this.strCalles[1].removeWords(k) } } }; this.esAlturaSN = function (k) { return j.test(k) } } })(jQuery); usig.StringDireccion.CALLE = 0; usig.StringDireccion.CALLE_ALTURA = 1; usig.StringDireccion.CALLE_Y_CALLE = 2; usig.StringDireccion.INVALIDO = -1; if (typeof (usig) == "undefined") { usig = {} } usig.ErrorCalleInexistente = function (b) { this.toString = function () { return "Calle inexistente: " + b }; this.getNombreCalle = function () { return b }; this.getErrorMessage = function () { return usig.ErrorCalleInexistente.defaults.texts.message } }; usig.ErrorCalleInexistente.defaults = { texts: { message: "No pudo hallarse ninguna calle existente que coincidiera con su b&uacute;squeda. Por favor, revise el nombre ingresado y vuelva a intentarlo." } }; if (typeof (usig) == "undefined") { usig = {} } usig.ErrorCalleInexistenteAEsaAltura = (function (b) { return function (d, c, e) { this.getCalle = function () { return d }; this.getMatchings = function () { return c }; this.getAltura = function () { return e }; this.toString = function () { return "La calle " + d + " no existe a la altura " + e }; this.getErrorMessage = function () { var f = usig.ErrorCalleInexistenteAEsaAltura.defaults.texts.message + "<ul>"; b.each(c, function (h, j) { var g = j.getTramos(); b.each(g, function (k, l) { f += "<li>" + j.nombre + " " + l[0] + "-" + l[1] + "</li>" }) }); f += "</ul>"; return f } } })(jQuery); usig.ErrorCalleInexistenteAEsaAltura.defaults = { texts: { message: "La altura indicada no es v&aacute;lida para la calle ingresada. A continuaci&oacute;n se muestran algunas opciones v&aacute;lidas halladas:" } }; if (typeof (usig) == "undefined") { usig = {} } usig.ErrorCruceInexistente = (function (b) { return function (d, f, c, e) { this.getCalle1 = function () { return d }; this.getCalle2 = function () { return c }; this.getMatchingsCalle1 = function () { return f }; this.getMatchingsCalle2 = function () { return e }; this.toString = function () { return "Cruce inexistente: " + d + " y " + c }; this.getErrorMessage = function () { var g = usig.ErrorCruceInexistente.defaults.texts.message; g += "<br/>" + usig.ErrorCruceInexistente.defaults.texts.detalleCalle1 + "<ul>"; b.each(f, function (h, j) { g += "<li>" + j.nombre + "</li>" }); g += "</ul>"; g += usig.ErrorCruceInexistente.defaults.texts.detalleCalle2 + "<ul>"; b.each(e, function (h, j) { g += "<li>" + j.nombre + "</li>" }); g += "</ul>"; return g } } })(jQuery); usig.ErrorCruceInexistente.defaults = { texts: { message: "El cruce de calles indicado no existe. A continuaci&oacute;n se muestran algunas calles que coinciden con su b&uacute;squeda.", detalleCalle1: "Algunas calles halladas que coinciden con la 1ra calle ingresada son:", detalleCalle2: "Algunas calles halladas que coinciden con la 2da calle ingresada son:" } }; if (typeof (usig) == "undefined") { usig = {} } usig.ErrorCalleSinAlturas = function (b) { this.toString = function () { return usig.ErrorCalleSinAlturas.defaults.texts.message.replace("{calle}", b) }; this.getNombreCalle = function () { return b }; this.getErrorMessage = function () { return usig.ErrorCalleSinAlturas.defaults.texts.message.replace("{calle}", b) } }; usig.ErrorCalleSinAlturas.defaults = { texts: { message: "La calle {calle} no posee alturas oficiales. Utilice intersecciones para hallar direcciones v&aacute;lidas sobre esta calle o escriba S/N en lugar de la altura." } }; if (typeof (usig) == "undefined") { usig = {} } usig.ErrorEnCargaDelCallejero = function () { this.toString = function () { return "Callejero no disponible." }; this.getErrorMessage = function () { return "El callejero no se encuentra cargado aún o se produjo un error al intentar cargarlo" } }; if (typeof (usig) == "undefined") { usig = {} } if (typeof (usig.defaults) == "undefined") { usig.defaults = {} } usig.defaults.NormalizadorDirecciones = { lazyDataLoad: false, loadFullDatabase: true, aceptarCallesSinAlturas: false, callesEnMinusculas: false, maxPalabras: 7 }; usig.NormalizadorDirecciones = (function (f) { var h = {}, e = false, l = { ready: [] }, u = null; re = { cruceCalles: /\s+y\s+/gi, calleAltura: [], calle: [] }; function j(z, A, y) { var c = u.matcheaCalle(z.strCalles); try { var x = s(z, c, A) } catch (w) { throw (w) } if (x.length == 0 && c.length > 0) { z.quitarAvsCalle(); c = u.matcheaCalle(z.strCalles); try { x = s(z, c, A) } catch (w) { throw (w) } x = n(x); if (x.length == 0) { throw (new usig.ErrorCalleInexistenteAEsaAltura(z.strCalles, c, z.strAltura)) } } else { if (x.length == 0 && c.length == 0) { z.quitarPasajes(); c = u.matcheaCalle(z.strCalles); try { x = s(z, c, A) } catch (w) { throw (w) } } } if (y && x.length > 1) { f.each(x, function (C, B) { if (m(z.strCalles, B.getCalle().nombre)) { x = [B] } }) } return x } function m(x, w) { function c(y) { y = y.replace(/"/g, "").translate("áéíóúüÁÉÍÓÚÜàèìòùÀÈÌÒÙ", "aeiouuAEIOUUaeiouAEIOU").toUpperCase().trim(); y = y.split(" "); return y } x = c(x); w = c(w); if (x.length == w.length) { intersect = x.intersect(w); if (x.length == intersect.length) { return true } } return false } function s(A, w, B) { var c = new Array(); var z = 0; if (w.length != 0) { for (var y = 0; y < w.length; y++) { try { if (w[y].alturaValida(A.strAltura)) { c.push(new usig.Direccion(w[y], A.strAltura)) } } catch (x) { if (x instanceof usig.ErrorCalleSinAlturas && h.aceptarCallesSinAlturas && A.esAlturaSN(A.strAltura)) { c.push(new usig.Direccion(w[y], 0)) } z++ } if (!isNaN(parseInt(B)) && c.length >= parseInt(B)) { break } } if (w.length == z && c.length == 0) { throw (new usig.ErrorCalleSinAlturas(w[0].toString())) } } return c } function n(y, z) { var x = z ? z : "getCalle"; var w = new Array(); for (var c = 0; c < y.length; c++) { if (u.tieneTramosComoAv(y[c][x]())) { w.push(y[c]) } } return w } function t(J, I) { var L = u.matcheaCalle(J.strCalles[0]); var K = u.matcheaCalle(J.strCalles[1]); var F = new Array(); function G(N, M) { return Math.min(N.codigo, M.codigo) + Math.max(N.codigo, M.codigo) } var c = new Array(); for (var C = 0; C < L.length; C++) { for (var z = 0; z < K.length; z++) { if (L[C].codigo != K[z].codigo && F.indexOf(G(L[C], K[z])) < 0 && L[C].seCruzaCon(K[z]) && K[z].seCruzaCon(L[C])) { c.push(new usig.Direccion(L[C], K[z])); F.push(G(L[C], K[z])); if (!isNaN(parseInt(I)) && c.length >= parseInt(I)) { break } } } if (!isNaN(parseInt(I)) && c.length >= parseInt(I)) { break } } if (c.length == 0 && L.length > 0 && K.length > 0) { var E = J.strCalles[0].split(" "); var B = J.strCalles[1].split(" "); if (E.indexOf("AV") >= 0 || E.indexOf("AVDA") >= 0 || E.indexOf("AVENIDA") >= 0) { var D = f.extend(true, {}, J); D.quitarAvsCalle(); try { var y = t(D, I) } catch (H) { throw (new usig.ErrorCruceInexistente(J.strCalles[0], L, J.strCalles[1], K)) } n(y); if (y instanceof Array) { return y } } if (B.indexOf("AV") >= 0 || B.indexOf("AVDA") >= 0 || B.indexOf("AVENIDA") >= 0) { var A = f.extend(true, {}, J); A.quitarAvsCalleCruce(); try { var x = t(A, I) } catch (H) { throw (new usig.ErrorCruceInexistente(J.strCalles[0], L, J.strCalles[1], K)) } n(x, "getCalleCruce"); if (x instanceof Array) { return x } } } if (c.length < I) { var w = u.matcheaCalle(J.strInput); var C = 0; while (c.length < I && C < w.length) { c.push(w[C]); C++ } } if (c.length == 0 && L.length > 0 && K.length > 0) { throw (new usig.ErrorCruceInexistente(J.strCalles[0], L, J.strCalles[1], K)) } return c } function p(w) { for (var c = 0; c < l[w].length; c++) { l[w][c]() } if (w == "ready") { l.ready = [] } } function o(x, w) { var y = false; for (var c = 0; c < l[x].length; c++) { y = y || (l[x][c] == w) } if (!y) { l[x].push(w) } } function v(y, z, w) { if (typeof (w) == "undefined") { w = true } if (typeof (jQuery) == "undefined") { throw ("Error: Este componente requiere jQuery y no se encontro."); return [] } var x = new usig.StringDireccion(y, h.aceptarCallesSinAlturas); var c = []; switch (x.tipo) { case usig.StringDireccion.CALLE: c = u.matcheaCalle(x.strCalles, z); break; case usig.StringDireccion.CALLE_ALTURA: c = j(x, z, w); break; case usig.StringDireccion.CALLE_Y_CALLE: c = t(x, z); if (c.length == 0) { x.setearCalleAltura(); c = j(x, z, w) } break; case usig.StringDireccion.INVALIDO: c = []; break }if (c instanceof Array) { if (c.length > 0) { return c } else { throw (new usig.ErrorCalleInexistente(y)) } } else { return c } } function d(w, x, z) { textoCalle = w.substring(0, x).reverse(); textoCruce = w.substr(x + z); conector = w.substr(x, z); var B = cruce = ""; var c = rCruce = []; try { try { for (var y = 1; y < h.maxPalabras; ++y) { cruce = textoCruce.match(re.calle[y])[0]; if (textoCruce.search(re.calle[y]) != 0) { throw "Direccion no valida" } rCruce = v(cruce, 2, false) } } catch (A) { cruce = textoCruce.match(re.calle[y - 1])[0] } try { for (var y = 1; y < h.maxPalabras; ++y) { B = textoCalle.match(re.calle[y])[0].reverse(); if (textoCalle.search(re.calle[y]) != 0) { throw "Direccion no valida" } c = v(B, 2, false) } } catch (A) { B = textoCalle.match(re.calle[y - 1])[0].reverse() } resultados = v(B + conector + cruce, 2, false); if (resultados.length == 1 && r(resultados[0], B + conector + cruce)) { return { match: resultados[0], pos: w.search(B), len: B.length + conector.length + cruce.length } } else { return false } } catch (C) { return false } return false } function q(c) { textoDireccion = c.reverse(); var x = ""; var A = []; try { try { for (var w = 1; w < h.maxPalabras; ++w) { x = textoDireccion.match(re.calleAltura[w])[0].reverse(); if (textoDireccion.search(re.calleAltura[w]) != 0) { throw "Direccion no valida" } A = v(x, 2, false) } } catch (y) { x = textoDireccion.match(re.calleAltura[w - 1])[0].reverse(); A = v(x, 2, false) } if (r(A[0], x)) { return { match: A[0], pos: c.search(x), len: x.length } } } catch (z) { return false } return false } function b(c, w) { var x = []; var y = /((\s+y\s+)|(\s+\d+))/gi; while (matcheo = y.exec(c)) { if (matcheo[0].match(re.cruceCalles)) { res = d(c, matcheo.index, matcheo[0].length) } else { res = q(c.substring(0, matcheo.index + matcheo[0].length)) } if (res) { if (x.length > 0) { if (res.pos == x[x.length - 1].pos && res.match.toString() == x[x.length - 1].match.toString()) { if (res.len > x[x.length - 1].len) { x.pop(); x.push(res) } } else { x.push(res) } } else { x.push(res) } } if (!(!w || x.length < w)) { return x } } return x.length > 0 ? x : false } function k(y) { var x = ["Á", "É", "Í", "Ó", "Ú", "Ü"]; var w = ["A", "E", "I", "O", "U", "U"]; for (var c = 0; c < x.length; ++c) { y = y.replace(x[c], w[c]) } return y } function r(y, w) { var c = k(w.toUpperCase()).split(" "); var x = y.toString().toUpperCase().replace(/[,.]/g, "").split(" "); for (var A = 0; A < c.length - 1; A++) { for (var z = 0; z < x.length - 1; z++) { if (c[A] == x[z] && c[A].length > 3) { return true } } } return false } function g(w, c) { return w.pos - c.pos } return { normalizar: v, buscarDireccion: function (c) { var w = b(c, 1); return w ? w[0] : false }, buscarDirecciones: function (c, w) { var x = b(c, w); return x ? x : false }, listo: function () { return u ? u.listo() : false }, setOptions: function (c) { h = f.extend({}, h, c); if (typeof (h.onReady) == "function") { o("ready", h.onReady) } }, init: function (c) { h = f.extend({}, usig.defaults.NormalizadorDirecciones, c); if (typeof (h.onReady) == "function") { o("ready", h.onReady) } u = usig.Callejero.init({ lazyDataLoad: h.lazyDataLoad, loadFullDatabase: h.loadFullDatabase, callesEnMinusculas: h.callesEnMinusculas, onReady: p.createDelegate(this, ["ready"]) }); for (var w = 1; w <= h.maxPalabras; w++) { re.calleAltura[w] = new RegExp("(\\d+(\\s+(\\w|\\d|á|é|í|ó|ú|ü|ñ|'|`|,|\\.)+){" + w + "})", "gi"); re.calle[w] = new RegExp("(\\w|\\d|á|é|í|ó|ú|ü|ñ|'|`|,|\\.)+(\\s+(\\w|\\d|á|é|í|ó|ú|ü|ñ|'|`|,|\\.)+){" + (w - 1) + "}", "gi") } String.prototype.reverse = function () { return this.split("").reverse().join("") }; e = true; return this }, c: u, inicializado: function () { return e } } })(jQuery);